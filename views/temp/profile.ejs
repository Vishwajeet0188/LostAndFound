<% layout("layouts/boilerplate") %>

<div class="container mt-4 mb-5">
  <!-- Back Button -->
  <a href="/dashboard" class="btn btn-outline-secondary mb-4">
    <i class="fas fa-arrow-left me-2"></i> Back to Dashboard
  </a>

  <div class="row">
    <!-- Left: Profile Info -->
    <div class="col-lg-4 mb-4">
      <div class="card shadow-sm border-0">
        <div class="card-body text-center">
          <!-- Profile Picture -->
          <div class="avatar-wrapper mb-3">
            <% if (user.profilePicture) { %>
              <img src="<%= user.profilePicture %>" 
                   alt="Profile" 
                   class="avatar-img rounded-circle">
            <% } else { %>
              <div class="avatar-placeholder rounded-circle">
                <i class="fas fa-user fa-3x text-muted"></i>
              </div>
            <% } %>
           <button
                class="btn btn-sm btn-outline-primary change-photo-btn"
                data-bs-toggle="modal"
                data-bs-target="#changePhotoModal"
                >
                <i class="fas fa-camera me-1"></i> Change Photo
            </button>

          </div>
          
          <h4 class="mb-1"><%= user.name || 'User' %></h4>
          <p class="text-muted mb-3"><%= user.email %></p>
          
            <% if (typeof userStats !== 'undefined') { %>
                <div class="user-stats d-flex justify-content-around">
                    <div class="stat-item">
                    <h5 class="mb-1"><%= userStats.listedItems || 0 %></h5>
                    <small class="text-muted">Listed Items</small>
                    </div>
                    <div class="stat-item">
                    <h5 class="mb-1"><%= userStats.foundItems || 0 %></h5>
                    <small class="text-muted">Found Items</small>
                    </div>
                </div>
            <% } %>
        </div>
      </div>
    </div>

    <!-- Right: Profile Form -->
    <div class="col-lg-8">
      <div class="card shadow-sm border-0">
        <div class="card-body">
          <h4 class="card-title mb-4">
            <i class="fas fa-user-edit me-2"></i> Edit Profile
          </h4>

          <form action="/profile/update" method="POST">
            <div class="row">
              <!-- Full Name -->
              <div class="col-md-6 mb-3">
                <label class="form-label">Full Name *</label>
                <input type="text" 
                       class="form-control" 
                       name="name" 
                       value="<%= user.name || '' %>" 
                       required>
              </div>

              <!-- Email -->
              <div class="col-md-6 mb-3">
                <label class="form-label">Email *</label>
                <input type="email" 
                       class="form-control" 
                       value="<%= user.email %>" 
                       disabled>
                <small class="text-muted">Email cannot be changed</small>
              </div>
            </div>

            <!-- Phone -->
            <div class="mb-3">
              <label class="form-label">Phone Number</label>
              <input type="tel" 
                     class="form-control" 
                     name="phone" 
                     value="<%= user.phone || '' %>"
                     placeholder="+91 9876543210">
            </div>

            <!-- Address -->
            <div class="mb-3">
              <label class="form-label">Address</label>
              <textarea class="form-control" 
                        name="address" 
                        rows="3" 
                        placeholder="Enter your address"><%= user.address || '' %></textarea>
            </div>

            <!-- Bio -->
            <div class="mb-4">
              <label class="form-label">Bio</label>
              <textarea class="form-control" 
                        name="bio" 
                        rows="3" 
                        placeholder="Tell us about yourself"><%= user.bio || '' %></textarea>
            </div>

            <!-- Submit Buttons -->
            <div class="d-flex gap-2">
              <button type="submit" class="btn btn-primary">
                <i class="fas fa-save me-2"></i> Save Changes
              </button>
              <a href="/dashboard" class="btn btn-outline-secondary">Cancel</a>
            </div>
          </form>

          <!-- Change Password Section -->
          <hr class="my-4">
          <h5 class="mb-3">
            <i class="fas fa-lock me-2"></i> Change Password
          </h5>
          
          <form action="/profile/change-password" method="POST">
            <div class="row">
              <div class="col-md-4 mb-3">
                <label class="form-label">Current Password</label>
                <input type="password" class="form-control" name="currentPassword" required>
              </div>
              <div class="col-md-4 mb-3">
                <label class="form-label">New Password</label>
                <input type="password" class="form-control" name="newPassword" required>
              </div>
              <div class="col-md-4 mb-3">
                <label class="form-label">Confirm Password</label>
                <input type="password" class="form-control" name="confirmPassword" required>
              </div>
            </div>
            <button type="submit" class="btn btn-warning">
              <i class="fas fa-key me-2"></i> Change Password
            </button>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Change Photo Modal -->
<div class="modal fade" id="changePhotoModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Change Profile Photo</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <form action="/profile/upload-photo" method="POST" enctype="multipart/form-data">
        <div class="modal-body">
          <div class="mb-3">
            <label class="form-label">Select New Photo</label>
            <input type="file" class="form-control" name="profilePicture" accept="image/*">
          </div>
          <div class="alert alert-info">
            <small>Maximum file size: 2MB. Supported formats: JPG, PNG, GIF</small>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-primary">Upload Photo</button>
        </div>
      </form>
    </div>
  </div>
</div>

<style>
.avatar-wrapper {
  position: relative;
}

.avatar-img {
  width: 120px;
  height: 120px;
  object-fit: cover;
  border: 4px solid #fff;
  box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}

.avatar-placeholder {
  width: 120px;
  height: 120px;
  background: #f8f9fa;
  display: flex;
  align-items: center;
  justify-content: center;
  margin: 0 auto;
  border: 4px solid #fff;
  box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}

.user-stats {
  border-top: 1px solid #dee2e6;
  padding-top: 15px;
  margin-top: 15px;
}

.stat-item {
  text-align: center;
}

.stat-item h5 {
  font-weight: 700;
  color: #667eea;
}

.form-label {
  font-weight: 600;
  color: #495057;
}

.card {
  border-radius: 12px;
  border: 1px solid #e9ecef;
}

.card-title {
  color: #2d2f48;
  border-bottom: 2px solid #667eea;
  padding-bottom: 10px;
}

.modal-header{
    display: flex;

}

/* /* // profile button */

.change-photo-btn {
  display: block;         
  margin: 8px auto 0 auto; 
  padding: 4px 14px;
  font-size: 0.8rem;
  border-radius: 20px;
  white-space: nowrap;
}


</style>